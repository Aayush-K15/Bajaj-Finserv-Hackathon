
import urllib.request as urllib2

from oauthlib.common import quote, unquote

UNICODE_ASCII_CHARACTER_SET = ('abcdefghijklmnopqrstuvwxyz'
                               'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
                               '0123456789')


def filter_params(target):
    
    def wrapper(params, *args, **kwargs):
        params = filter_oauth_params(params)
        return target(params, *args, **kwargs)

    wrapper.__doc__ = target.__doc__
    return wrapper


def filter_oauth_params(params):
    
    def is_oauth(kv):
        return kv[0].startswith('oauth_')
    if isinstance(params, dict):
        return list(filter(is_oauth, list(params.items())))
    else:
        return list(filter(is_oauth, params))


def escape(u):
    
    if not isinstance(u, str):
        raise ValueError('Only unicode objects are escapable. ' +
                         'Got {!r} of type {}.'.format(u, type(u)))
    
    
    return quote(u, safe=b'~')


def unescape(u):
    if not isinstance(u, str):
        raise ValueError('Only unicode objects are unescapable.')
    return unquote(u)


def parse_keqv_list(l):  
    
    
    return urllib2.parse_keqv_list(l)


def parse_http_list(u):
    
    
    return urllib2.parse_http_list(u)


def parse_authorization_header(authorization_header):
    
    auth_scheme = 'OAuth '.lower()
    if authorization_header[:len(auth_scheme)].lower().startswith(auth_scheme):
        items = parse_http_list(authorization_header[len(auth_scheme):])
        try:
            return list(parse_keqv_list(items).items())
        except (IndexError, ValueError):
            pass
    raise ValueError('Malformed authorization header')

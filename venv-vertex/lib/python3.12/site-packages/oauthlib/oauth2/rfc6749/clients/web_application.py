

import warnings

from ..parameters import (
    parse_authorization_code_response, prepare_grant_uri,
    prepare_token_request,
)
from .base import Client


class WebApplicationClient(Client):

    

    grant_type = 'authorization_code'

    def __init__(self, client_id, code=None, **kwargs):
        super().__init__(client_id, **kwargs)
        self.code = code

    def prepare_request_uri(self, uri, redirect_uri=None, scope=None,
                            state=None, code_challenge=None, code_challenge_method='plain', **kwargs):
        
        scope = self.scope if scope is None else scope
        return prepare_grant_uri(uri, self.client_id, 'code',
                                 redirect_uri=redirect_uri, scope=scope, state=state, code_challenge=code_challenge,
                                 code_challenge_method=code_challenge_method, **kwargs)

    def prepare_request_body(self, code=None, redirect_uri=None, body='',
                             include_client_id=True, code_verifier=None, **kwargs):
        
        code = code or self.code
        if 'client_id' in kwargs:
            warnings.warn("`client_id` has been deprecated in favor of "
                          "`include_client_id`, a boolean value which will "
                          "include the already configured `self.client_id`.",
                          DeprecationWarning)
            if kwargs['client_id'] != self.client_id:
                raise ValueError("`client_id` was supplied as an argument, but "
                                 "it does not match `self.client_id`")

        kwargs['client_id'] = self.client_id
        kwargs['include_client_id'] = include_client_id
        return prepare_token_request(self.grant_type, code=code, body=body,
                                     redirect_uri=redirect_uri, code_verifier=code_verifier, **kwargs)

    def parse_request_uri_response(self, uri, state=None):
        
        response = parse_authorization_code_response(uri, state=state)
        self.populate_code_attributes(response)
        return response

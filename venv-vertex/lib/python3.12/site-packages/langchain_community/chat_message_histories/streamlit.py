from typing import List

from langchain_core.chat_history import BaseChatMessageHistory
from langchain_core.messages import BaseMessage


class StreamlitChatMessageHistory(BaseChatMessageHistory):
    

    def __init__(self, key: str = "langchain_messages"):
        try:
            import streamlit as st
        except ImportError as e:
            raise ImportError(
                "Unable to import streamlit, please run `pip install streamlit`."
            ) from e

        if key not in st.session_state:
            st.session_state[key] = []
        self._messages = st.session_state[key]
        self._key = key

    @property
    def messages(self) -> List[BaseMessage]:
        
        return self._messages

    @messages.setter
    def messages(self, value: List[BaseMessage]) -> None:
        
        import streamlit as st

        st.session_state[self._key] = value
        self._messages = st.session_state[self._key]

    def add_message(self, message: BaseMessage) -> None:
        
        self.messages.append(message)

    def clear(self) -> None:
        
        self.messages.clear()

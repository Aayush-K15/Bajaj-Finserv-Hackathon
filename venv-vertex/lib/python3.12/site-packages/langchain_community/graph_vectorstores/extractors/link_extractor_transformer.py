from typing import Any, Sequence

from langchain_core._api import beta
from langchain_core.documents import Document
from langchain_core.documents.transformers import BaseDocumentTransformer

from langchain_community.graph_vectorstores.extractors.link_extractor import (
    LinkExtractor,
)
from langchain_community.graph_vectorstores.links import copy_with_links


@beta()
class LinkExtractorTransformer(BaseDocumentTransformer):
    

    def __init__(self, link_extractors: Sequence[LinkExtractor[Document]]):
        
        self.link_extractors = link_extractors

    def transform_documents(
        self, documents: Sequence[Document], **kwargs: Any
    ) -> Sequence[Document]:
        
        

        
        links_per_extractor = [e.extract_many(documents) for e in self.link_extractors]

        
        links_per_document = zip(*links_per_extractor)

        return [
            copy_with_links(document, *links)
            for document, links in zip(documents, links_per_document)
        ]

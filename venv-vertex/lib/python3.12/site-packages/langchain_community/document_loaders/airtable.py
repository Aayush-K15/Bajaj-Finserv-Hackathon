from typing import Any, Iterator

from langchain_core.document_loaders import BaseLoader
from langchain_core.documents import Document


class AirtableLoader(BaseLoader):
    

    def __init__(
        self, api_token: str, table_id: str, base_id: str, **kwargs: Any
    ) -> None:
          
        self.api_token = api_token
        self.table_id = table_id
        self.base_id = base_id
        self.kwargs = kwargs

    def lazy_load(self) -> Iterator[Document]:
        

        from pyairtable import Table

        table = Table(self.api_token, self.base_id, self.table_id)
        records = table.all(**self.kwargs)
        for record in records:
            metadata = {
                "source": self.base_id + "_" + self.table_id,
                "base_id": self.base_id,
                "table_id": self.table_id,
            }
            if "view" in self.kwargs:
                metadata["view"] = self.kwargs["view"]
            
            yield Document(page_content=str(record), metadata=metadata)

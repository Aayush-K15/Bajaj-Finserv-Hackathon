from typing import Callable, Union

from langchain_core.documents import Document

from langchain_community.docstore.base import Docstore


class DocstoreFn(Docstore):
    

    def __init__(
        self,
        lookup_fn: Callable[[str], Union[Document, str]],
    ):
        self._lookup_fn = lookup_fn

    def search(self, search: str) -> Document:
        
        r = self._lookup_fn(search)
        if isinstance(r, str):
            
            return Document(page_content=r, metadata={"source": search})
        elif isinstance(r, Document):
            return r
        raise ValueError(f"Unexpected type of document {type(r)}")

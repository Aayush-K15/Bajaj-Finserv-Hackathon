
















from typing import Dict, Optional

try:
    import starlette
except ImportError:
    raise ImportError(
        "Starlette is not installed and is required to build model servers. "
        'Please install the SDK using `pip install "google-cloud-aiplatform[prediction]>=1.16.0"`.'
    )

from google.cloud.aiplatform.constants import prediction


def _remove_parameter(value: Optional[str]) -> Optional[str]:
    
    if value is None:
        return None

    return value.split(";")[0]


def get_content_type_from_headers(
    headers: Optional[starlette.datastructures.Headers],
) -> Optional[str]:
    
    if headers is not None:
        for key, value in headers.items():
            if prediction.CONTENT_TYPE_HEADER_REGEX.match(key):
                return _remove_parameter(value)

    return None


def get_accept_from_headers(
    headers: Optional[starlette.datastructures.Headers],
) -> str:
    
    if headers is not None:
        for key, value in headers.items():
            if prediction.ACCEPT_HEADER_REGEX.match(key):
                return value

    return prediction.DEFAULT_ACCEPT_VALUE


def parse_accept_header(accept_header: Optional[str]) -> Dict[str, float]:
    
    if not accept_header:
        return {}

    all_accepts = accept_header.split(",")
    results = {}

    for media_type in all_accepts:
        if media_type.split(";")[0] == media_type:
            
            results[media_type.strip()] = 1.0
        else:
            q = media_type.split(";")[1].split("=")[1]
            results[media_type.split(";")[0].strip()] = float(q)

    return results










































__version__ = '0.07'




import os, fnmatch, glob, zipfile



class PathNotFoundException(Exception):
    
    def __init__(self, path):
        super(PathNotFoundException, self).__init__(
            'Given path does not exist: %r' % path)






def rglob (path, pattern='*.*'):
    
    
    return [os.path.join(dirpath, f)
        for dirpath, dirnames, files in os.walk(path)
        for f in fnmatch.filter(files, pattern)]


def riglob (pathname):
    
    path, filespec = os.path.split(pathname)
    
    if path == '':
        path = '.'
    
    for dirpath, dirnames, files in os.walk(path):
        for f in fnmatch.filter(files, filespec):
            yield os.path.join(dirpath, f)


def ziglob (zipfileobj, pathname):
    
    files = zipfileobj.namelist()
    
    for f in fnmatch.filter(files, pathname):
        yield f


def iter_files(files, recursive=False, zip_password=None, zip_fname='*'):
    
    
    
    
    
    
    if recursive:
        iglob = riglob
    else:
        iglob = glob.iglob
    for filespec in files:
        if not is_glob(filespec) and not os.path.exists(filespec):
            yield None, filespec, PathNotFoundException(filespec)
            continue
        for filename in iglob(filespec):
            if zip_password is not None:
                
                
                if not isinstance(zip_password, bytes):
                    zip_password = bytes(zip_password, encoding='utf8')
                
                
                
                z = zipfile.ZipFile(filename, 'r')
                
                for subfilename in ziglob(z, zip_fname):
                    
                    try:
                        data = z.read(subfilename, zip_password)
                        yield filename, subfilename, data
                    except Exception as e:
                        yield filename, subfilename, e
                z.close()
            else:
                
                
                yield None, filename, None
                
                
                


def is_glob(filespec):
    

    
    cleaned = filespec.replace('[*]', '').replace('[?]', '') \
                      .replace('[[]', '').replace('[]]', '').replace('[-]', '')

    
    return '*' in cleaned or '?' in cleaned or \
          ('[' in cleaned and ']' in cleaned)
